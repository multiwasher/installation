<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Somengil Compliance Portal</title>
    
    <!-- Tailwind CSS para Estilização Rápida -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons para Iconografia -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- jsPDF para Exportação de Fichas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- SignaturePad para Assinaturas Digitais -->
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>

    <!-- Estilos Externos -->
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- ECRÃ DE LOGIN -->
    <div id="view-login" class="min-h-screen flex items-center justify-center p-4 bg-white">
        <div class="w-full p-10 rounded-2xl text-center login-gradient shadow-2xl border border-black/20" style="max-width: 480px;">
            
            <!-- Logo Somengil -->
            <img src="https://static.wixstatic.com/media/a6967f_0c98d57376be4290aba002d8ba028a92~mv2.webp" alt="Somengil" class="h-[5.6rem] mx-auto mb-2">
            
            <!-- Emblema Compliance Portal -->
            <div class="py-12 flex justify-center">
                <div class="emblema-outer">
                    <div class="emblema-inner">
                        <p class="text-white font-extrabold uppercase text-lg tracking-[0.25em] whitespace-nowrap">Compliance Portal</p>
                    </div>
                </div>
            </div>

            <!-- Seleção de Idioma -->
            <div class="flex justify-center gap-3 mb-6">
                <button class="text-[10px] font-black uppercase tracking-widest px-3 py-1.5 border border-white/20 rounded text-white bg-white/10">PT</button>
                <button class="text-[10px] font-black uppercase tracking-widest px-3 py-1.5 border border-white/20 rounded text-white/40">EN</button>
                <button class="text-[10px] font-black uppercase tracking-widest px-3 py-1.5 border border-white/20 rounded text-white/40">FR</button>
                <button class="text-[10px] font-black uppercase tracking-widest px-3 py-1.5 border border-white/20 rounded text-white/40">ES</button>
            </div>

            <hr class="border-black/30 mb-8">

            <h2 class="text-white text-xl font-black uppercase tracking-tight">Bem-vindo</h2>
            <p class="text-white/50 text-[10px] font-bold uppercase tracking-widest mb-8">Sessão Segura</p>

            <!-- Formulário de Login -->
            <form id="login-form" class="space-y-5 max-w-[320px] mx-auto text-left">
                <div class="relative">
                    <i data-lucide="user" class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"></i>
                    <input type="text" id="login-user" placeholder="Utilizador" class="w-full bg-white text-slate-900 rounded-xl p-3.5 pl-12 font-semibold outline-none shadow-inner" required>
                </div>
                <div class="relative">
                    <i data-lucide="lock" class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"></i>
                    <input type="password" id="login-pass" placeholder="Senha" class="w-full bg-white text-slate-900 rounded-xl p-3.5 pl-12 font-semibold outline-none shadow-inner" required>
                </div>
                <div id="login-error" class="text-red-400 text-[11px] font-bold text-center hidden">Credenciais inválidas.</div>
                
                <button type="submit" class="w-full py-4 rounded-xl font-bold uppercase tracking-[0.15em] text-sm mt-4 text-white shadow-xl flex items-center justify-center gap-3 btn-entrar">
                    Entrar <i data-lucide="arrow-right" class="w-4 h-4"></i>
                </button>
            </form>

            <hr class="border-black/30 mt-12 mb-4">
            <p class="text-white/40 text-[10px] font-bold tracking-widest uppercase">© Somengil 2025.</p>
        </div>
    </div>

    <!-- CONTENTOR PRINCIPAL DA APP -->
    <div id="app-container" class="hidden flex min-h-screen">
        
        <!-- BARRA LATERAL (SIDEBAR) -->
        <aside id="sidebar" class="sidebar fixed h-full flex flex-col py-6">
            <div id="sidebar-logo-container" class="px-6 mb-6 flex flex-col items-center transition-all duration-300">
                <img id="sidebar-logo" src="https://static.wixstatic.com/media/a6967f_0c98d57376be4290aba002d8ba028a92~mv2.webp" alt="Somengil" class="h-14 mb-4 sidebar-logo-img hidden">
            </div>
            <div class="px-6 mb-10 flex items-center gap-4">
                <div class="bg-blue-600 p-2 rounded-xl text-white min-w-[40px] flex justify-center items-center">
                    <i data-lucide="shield-check"></i>
                </div>
                <span class="sidebar-text text-white font-black uppercase text-sm tracking-widest hidden">Somengil Admin</span>
            </div>

            <nav class="flex-1 px-4 space-y-2 overflow-y-auto overflow-x-hidden">
                <div onclick="setView('dashboard')" class="nav-item" id="nav-dashboard">
                    <i data-lucide="layout-dashboard"></i>
                    <span class="sidebar-text ml-4 hidden font-bold text-sm">Dashboard</span>
                </div>
                <div onclick="setView('voos')" class="nav-item" id="nav-voos">
                    <i data-lucide="plane"></i>
                    <span class="sidebar-text ml-4 hidden font-bold text-sm">Voos</span>
                </div>
                <div onclick="setView('costs')" class="nav-item" id="nav-costs">
                    <i data-lucide="wallet"></i>
                    <span class="sidebar-text ml-4 hidden font-bold text-sm">Despesas</span>
                </div>

                <!-- Espaço flexível para empurrar o logo para o centro -->
                <div class="flex-1 flex flex-col">
                    <div class="flex-1"></div>
                    <div id="sidebar-collapsed-logo-container" class="flex justify-center items-center w-full mb-6">
                        <img id="sidebar-collapsed-logo" src="https://static.wixstatic.com/media/a6967f_13d13b69ac9043cda4d9ca733e6f7372~mv2.png" alt="Somengil Small" class="w-full max-w-[80%] sidebar-collapsed-logo" style="object-fit:contain;">
                    </div>
                </div>
                <div id="sidebar-sections" class="mt-8 space-y-1 hidden">
                    <p class="px-3 text-[10px] font-black text-slate-500 uppercase mb-4 tracking-widest">Progresso Secções</p>
                    <!-- Injetado dinamicamente via JS -->
                </div>
            </nav>

            <div class="px-4 pt-4 border-t border-slate-800">
                <div onclick="handleLogout()" class="nav-item text-red-400 hover:text-red-300">
                    <i data-lucide="log-out"></i>
                    <span class="sidebar-text ml-4 hidden font-bold text-sm">Sair</span>
                </div>
            </div>
        </aside>

        <!-- CONTEÚDO PRINCIPAL -->
        <main class="main-content flex-1">
            <header class="p-6 md:p-10 flex justify-between items-center bg-white/70 backdrop-blur-md sticky top-0 z-40 border-b border-slate-200">
                <button id="hamburger-btn" onclick="toggleSidebar()" class="p-3 bg-white rounded-xl shadow-sm border hover:bg-slate-50 hamburger-menu">
                    <i data-lucide="menu"></i>
                </button>
                <div class="flex items-center gap-4">
                    <div class="text-right hidden sm:block">
                        <p id="header-user-name" class="font-black text-slate-900 text-sm leading-none">Utilizador</p>
                        <p id="header-user-role" class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Cargo</p>
                    </div>
                    <div class="w-10 h-10 bg-slate-900 text-white rounded-xl flex items-center justify-center font-black ml-[5px]" id="user-avatar">U</div>
                </div>
            </header>

            <div class="p-6 md:p-10">
                <!-- VISTA DASHBOARD -->
                <div id="view-dashboard" class="space-y-10 animate-in fade-in duration-500 mt-[10px]">
                    <div class="flex justify-between items-end">
                        <div>
                            <h1 class="main-title">Compliance Central</h1>
                            <p class="text-slate-500 font-medium">Gestão de Fichas Técnicas Somengil.</p>
                        </div>
                        <span class="emblema-outer">
                            <button onclick="createNewForm()" class="text-white px-8 py-4 rounded-2xl font-black flex items-center gap-3 shadow-lg hover:bg-black transition-all" style="background:transparent;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="plus" class="lucide lucide-plus"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg> Nova Ficha
                            </button>
                        </span>
                    </div>

                    <div class="bg-white rounded-3xl border border-slate-200 overflow-hidden shadow-xl table-responsive-wrapper">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="bg-slate-50 text-[10px] font-black text-slate-400 uppercase">
                                    <tr>
                                        <th class="px-8 py-5">S/N Máquina</th>
                                        <th class="px-8 py-5">Cliente</th>
                                        <th class="px-8 py-5">Técnico</th>
                                        <th class="px-8 py-5">Progresso</th>
                                        <th class="px-8 py-5 text-right">Ação</th>
                                    </tr>
                                </thead>
                                <tbody id="table-body" class="divide-y divide-slate-100 font-semibold text-sm">
                                    <!-- Injetado dinamicamente via JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- VISTA FORMULÁRIO -->
                <div id="view-form" class="hidden max-w-5xl mx-auto space-y-12 pb-40 animate-in slide-in-from-right duration-500">
                    <div class="flex items-center justify-between sticky top-[110px] bg-[#f8fafc]/90 backdrop-blur-md py-4 z-30 border-b">
                        <button onclick="setView('dashboard')" class="p-3 bg-white rounded-xl shadow-sm border"><i data-lucide="arrow-left"></i></button>
                        <div class="flex gap-3">
                            <button onclick="exportCurrentToPDF()" class="bg-white text-emerald-600 border border-emerald-100 px-6 py-4 rounded-2xl font-black uppercase text-xs tracking-widest flex items-center gap-2 hover:bg-emerald-50 shadow-sm">
                                <i data-lucide="file-down"></i> PDF
                            </button>
                            <button onclick="saveForm()" class="bg-emerald-600 text-white px-10 py-4 rounded-2xl font-black uppercase text-xs tracking-widest flex items-center gap-3 shadow-xl hover:brightness-110">
                                <i data-lucide="save"></i> Gravar
                            </button>
                        </div>
                    </div>

                    <div id="form-sections-container">
                        <!-- Injetado dinamicamente via JS -->
                    </div>
                </div>

                <!-- VISTA VOOS -->
                <div id="view-voos" class="hidden space-y-10 animate-in fade-in duration-500 mt-[10px] pb-40">
                    <div class="flex justify-between items-end">
                        <div>
                            <h1 class="main-title">Gestão de Voos</h1>
                            <p class="text-slate-500 font-medium">Planeamento e controlo de deslocações.</p>
                        </div>
                        <button id="btn-new-flight" onclick="showFlightModal()" class="btn-principal">
                            <i data-lucide="plus"></i> Novo Voo
                        </button>
                    </div>

                    <!-- Filtros (apenas GESTÃO) -->
                    <div id="flight-filters" class="hidden bg-white rounded-3xl border border-slate-200 p-6 shadow-xl">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <label class="text-[10px] font-black text-slate-400 uppercase block mb-2">Data Início</label>
                                <input type="date" id="filter-flight-date-from" class="w-full p-2.5 border border-slate-200 rounded-xl focus:border-blue-500 outline-none">
                            </div>
                            <div>
                                <label class="text-[10px] font-black text-slate-400 uppercase block mb-2">Data Fim</label>
                                <input type="date" id="filter-flight-date-to" class="w-full p-2.5 border border-slate-200 rounded-xl focus:border-blue-500 outline-none">
                            </div>
                            <div>
                                <label class="text-[10px] font-black text-slate-400 uppercase block mb-2">Técnico</label>
                                <select id="filter-flight-technician" class="w-full p-2.5 border border-slate-200 rounded-xl focus:border-blue-500 outline-none">
                                    <option value="">Todos</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-[10px] font-black text-slate-400 uppercase block mb-2">Status</label>
                                <select id="filter-flight-status" class="w-full p-2.5 border border-slate-200 rounded-xl focus:border-blue-500 outline-none">
                                    <option value="">Todos</option>
                                    <option value="Planeado">Planeado</option>
                                    <option value="Confirmado">Confirmado</option>
                                    <option value="Realizado">Realizado</option>
                                    <option value="Cancelado">Cancelado</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex gap-3 mt-4">
                            <button onclick="applyFlightFilters()" class="bg-blue-600 text-white px-6 py-2 rounded-xl font-bold text-sm">Filtrar</button>
                            <button onclick="exportFlightsPDF()" class="bg-emerald-600 text-white px-6 py-2 rounded-xl font-bold text-sm flex items-center gap-2">
                                <i data-lucide="file-down" style="width:16px"></i> Exportar PDF
                            </button>
                        </div>
                    </div>

                    <!-- Tabela de Voos -->
                    <div class="bg-white rounded-3xl border border-slate-200 overflow-hidden shadow-xl">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="bg-slate-50 text-[10px] font-black text-slate-400 uppercase">
                                    <tr>
                                        <th class="px-8 py-5">Data Partida</th>
                                        <th class="px-8 py-5">Data Chegada</th>
                                        <th class="px-8 py-5">Aeroporto</th>
                                        <th class="px-8 py-5">Destino</th>
                                        <th class="px-8 py-5">Hora Partida</th>
                                        <th class="px-8 py-5">Hora Chegada</th>
                                        <th class="px-8 py-5">Técnico</th>
                                        <th class="px-8 py-5">Status</th>
                                        <th class="px-8 py-5 text-right">Ação</th>
                                    </tr>
                                </thead>
                                <tbody id="flights-table-body" class="divide-y divide-slate-100 font-semibold text-sm">
                                    <!-- Injetado dinamicamente via JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- MODAL NOVO VOO -->
                <div id="flight-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-3xl p-8 max-w-md w-full shadow-2xl">
                        <h2 class="text-2xl font-black text-slate-900 mb-6">Novo Voo</h2>
                        <form id="flight-form" class="space-y-4">
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="text-[10px] font-black text-slate-400 uppercase block mb-2">Data Partida</label>
                                    <input type="date" id="flight-date" class="w-full p-2.5 border border-slate-200 rounded-xl focus:border-blue-500 outline-none" required>
                                </div>
                                <div>
                                    <label class="text-[10px] font-black text-slate-400 uppercase block mb-2">Data Chegada</label>
                                    <input type="date" id="flight-date-arrival" class="w-full p-2.5 border border-slate-200 rounded-xl focus:border-blue-500 outline-none" required>
                                </div>
                            </div>
                            <div>
                                <label class="text-[10px] font-black text-slate-400 uppercase block mb-2">Aeroporto</label>
                                <input type="text" id="flight-airport" class="w-full p-2.5 border border-slate-200 rounded-xl focus:border-blue-500 outline-none" placeholder="Ex: LAX, CDG, LIS" required>
                            </div>
                            <div>
                                <label class="text-[10px] font-black text-slate-400 uppercase block mb-2">Destino</label>
                                <input type="text" id="flight-destination" class="w-full p-2.5 border border-slate-200 rounded-xl focus:border-blue-500 outline-none" required>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="text-[10px] font-black text-slate-400 uppercase block mb-2">Hora Partida</label>
                                    <input type="time" id="flight-departure-time" class="w-full p-2.5 border border-slate-200 rounded-xl focus:border-blue-500 outline-none" required>
                                </div>
                                <div>
                                    <label class="text-[10px] font-black text-slate-400 uppercase block mb-2">Hora Chegada</label>
                                    <input type="time" id="flight-arrival-time" class="w-full p-2.5 border border-slate-200 rounded-xl focus:border-blue-500 outline-none" required>
                                </div>
                            </div>
                            <div>
                                <label class="text-[10px] font-black text-slate-400 uppercase block mb-2">Técnico</label>
                                <select id="flight-technician" class="w-full p-2.5 border border-slate-200 rounded-xl focus:border-blue-500 outline-none" required>
                                    <option value="">Selecionar...</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-[10px] font-black text-slate-400 uppercase block mb-2">Status</label>
                                <select id="flight-status" class="w-full p-2.5 border border-slate-200 rounded-xl focus:border-blue-500 outline-none" required>
                                    <option value="Planeado">Planeado</option>
                                    <option value="Confirmado">Confirmado</option>
                                    <option value="Realizado">Realizado</option>
                                    <option value="Cancelado">Cancelado</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-[10px] font-black text-slate-400 uppercase block mb-2">Notas</label>
                                <textarea id="flight-notes" class="w-full p-2.5 border border-slate-200 rounded-xl focus:border-blue-500 outline-none" rows="3"></textarea>
                            </div>
                            <div class="flex gap-3 pt-4">
                                <button type="submit" class="flex-1 bg-blue-600 text-white py-2.5 rounded-xl font-bold">Guardar</button>
                                <button type="button" onclick="closeFlightModal()" class="flex-1 bg-slate-200 text-slate-900 py-2.5 rounded-xl font-bold">Cancelar</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div id="view-costs" class="hidden space-y-10 animate-in fade-in duration-500 p-6 md:p-10 mt-[10px]">
                    <div class="flex justify-between items-end">
                        <div>
                            <h1 class="main-title">Análise de Despesas</h1>
                            <p class="text-slate-500 font-medium">Registo e controlo de despesas.</p>
                        </div>
                        <button onclick="showCostModal()" class="btn-principal">
                            <i data-lucide="plus"></i> Novo Custo
                        </button>
                            <!-- Removed duplicate 'Novo Custo' button -->
                    </div>

                    <!-- Filtros e Tabela de Custos agrupados -->
                    <div class="bg-white rounded-3xl border border-slate-200 shadow-xl overflow-hidden">
                        <div id="cost-filters" class="hidden p-6 border-b border-slate-100">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="text-[10px] font-black text-slate-400 uppercase block mb-2">Data Início</label>
                                    <input type="date" id="filter-date-from" class="w-full p-2.5 border border-slate-200 rounded-xl focus:border-blue-500 outline-none">
                                </div>
                                <div>
                                    <label class="text-[10px] font-black text-slate-400 uppercase block mb-2">Data Fim</label>
                                    <input type="date" id="filter-date-to" class="w-full p-2.5 border border-slate-200 rounded-xl focus:border-blue-500 outline-none">
                                </div>
                                <div>
                                    <label class="text-[10px] font-black text-slate-400 uppercase block mb-2">Técnico</label>
                                    <select id="filter-technician" class="w-full p-2.5 border border-slate-200 rounded-xl focus:border-blue-500 outline-none">
                                        <option value="">Todos</option>
                                    </select>
                                </div>
                            </div>
                            <div class="flex gap-3 mt-4">
                                <button onclick="applyFilters()" class="bg-blue-600 text-white px-6 py-2 rounded-xl font-bold text-sm">Filtrar</button>
                                <button onclick="exportCostsPDF()" class="bg-emerald-600 text-white px-6 py-2 rounded-xl font-bold text-sm flex items-center gap-2">
                                    <i data-lucide="file-down" style="width:16px"></i> Exportar PDF
                                </button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="bg-slate-50 text-[10px] font-black text-slate-400 uppercase">
                                    <tr>
                                        <th class="px-4 py-5">Data</th>
                                        <th class="px-4 py-5">Tipo</th>
                                        <th class="px-4 py-5">Descrição</th>
                                        <th class="px-4 py-5">Valor (€)</th>
                                        <th class="px-4 py-5">Técnico</th>
                                        <th class="px-4 py-5 text-right">Ação</th>
                                    </tr>
                                </thead>
                                <tbody id="costs-table-body" class="divide-y divide-slate-100 font-semibold text-sm">
                                    <!-- Injetado dinamicamente via JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- MODAL NOVO CUSTO -->
                <div id="cost-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-3xl p-8 max-w-md w-full shadow-2xl">
                        <h2 class="text-2xl font-black text-slate-900 mb-6">Novo Custo</h2>
                        
                        <form id="cost-form" class="space-y-4">
                            <div>
                                <label class="text-[10px] font-black text-slate-400 uppercase block mb-2">Data</label>
                                <input type="date" id="cost-date" class="w-full p-2.5 border border-slate-200 rounded-xl focus:border-blue-500 outline-none" required>
                            </div>

                            <div>
                                <label class="text-[10px] font-black text-slate-400 uppercase block mb-2">Tipo</label>
                                <select id="cost-type" class="w-full p-2.5 border border-slate-200 rounded-xl focus:border-blue-500 outline-none" required>
                                    <option value="">Selecionar...</option>
                                    <option value="Combustível">Combustível</option>
                                    <option value="Manutenção">Manutenção</option>
                                    <option value="Pernoita">Pernoita</option>
                                    <option value="Refeição">Refeição</option>
                                    <option value="Transportes">Transportes</option>
                                    <option value="Outro">Outro</option>
                                </select>
                            </div>

                            <div>
                                <label class="text-[10px] font-black text-slate-400 uppercase block mb-2">Descrição</label>
                                <textarea id="cost-description" class="w-full p-2.5 border border-slate-200 rounded-xl focus:border-blue-500 outline-none" rows="3" required></textarea>
                            </div>

                            <div>
                                <label class="text-[10px] font-black text-slate-400 uppercase block mb-2">Valor (€)</label>
                                <input type="number" id="cost-value" class="w-full p-2.5 border border-slate-200 rounded-xl focus:border-blue-500 outline-none" step="0.01" min="0" required>
                            </div>

                            <div class="flex gap-3 pt-4">
                                <button type="submit" class="flex-1 bg-blue-600 text-white py-2.5 rounded-xl font-bold">Guardar</button>
                                <button type="button" onclick="closeCostModal()" class="flex-1 bg-slate-200 text-slate-900 py-2.5 rounded-xl font-bold">Cancelar</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- LÓGICA DA APLICAÇÃO E FIREBASE -->
    <script src="script.js"></script>
</body>
</html>